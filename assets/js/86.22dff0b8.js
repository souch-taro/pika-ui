(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{374:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"taro-request-请求库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#taro-request-请求库"}},[t._v("#")]),t._v(" Taro-Request 请求库")]),t._v(" "),s("ol",[s("li",[t._v("默认的请求头: "),s("code",[t._v("'content-type': 'application/x-www-form-urlencoded'")])])]),t._v(" "),s("h2",{attrs:{id:"安装和快速上手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装和快速上手"}},[t._v("#")]),t._v(" 安装和快速上手")]),t._v(" "),s("p",[t._v("安装:")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" @souche-taro/request\n")])])]),s("p",[t._v("使用:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" http "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@souche-taro/request"')]),t._v("\n\nhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.abc.com/test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        a"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        b"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"初始化实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化实例"}},[t._v("#")]),t._v(" 初始化实例")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" instance "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    baseURL"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.abc.com'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 等价于")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        a"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        b"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"别名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#别名"}},[t._v("#")]),t._v(" 别名")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => http.request({url,data,method:'GET',...config})")]),t._v("\nhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => http.request({url,data,method:'POST',...config})")]),t._v("\nhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => http.request({url,data,method:'PUT',...config})")]),t._v("\nhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => http.request({url,data,method:'DELETE',...config})")]),t._v("\n")])])]),s("h2",{attrs:{id:"重置配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重置配置"}},[t._v("#")]),t._v(" 重置配置")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// init config")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" instance "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// new config")]),t._v("\ninstance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"api-说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-说明"}},[t._v("#")]),t._v(" API 说明")]),t._v(" "),s("p",[t._v("基础参数:")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数名称")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("必须")]),t._v(" "),s("th",[t._v("默认")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("url")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("接口路径")])]),t._v(" "),s("tr",[s("td",[t._v("data")]),t._v(" "),s("td",[t._v("U")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("请求的参数")])]),t._v(" "),s("tr",[s("td",[t._v("method")]),t._v(" "),s("td",[s("code",[t._v('"OPTIONS" | "GET" | "HEAD" | "POST" | "PUT" | "DELETE" | "TRACE" | "CONNECT"')])]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v('"GET"')]),t._v(" "),s("td",[t._v("请求方法")])])])]),t._v(" "),s("p",[t._v("扩展选项:")]),t._v(" "),s("p",[t._v("V0.1.0\n"),s("strong",[t._v("老版本遵循的是Taro官方的参数")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数名称")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("必须")]),t._v(" "),s("th",[t._v("默认")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("baseURL")]),t._v(" "),s("td",[t._v("string")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("公共的基础URL")])]),t._v(" "),s("tr",[s("td",[t._v("soucheMode")]),t._v(" "),s("td",[t._v("boolean")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v("true")]),t._v(" "),s("td",[t._v("默认以搜车约定的格式返回数据, false可以返回完整response")])]),t._v(" "),s("tr",[s("td",[t._v("quiet")]),t._v(" "),s("td",[t._v("boolean")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v("false")]),t._v(" "),s("td",[t._v("沉默错误提示")])]),t._v(" "),s("tr",[s("td",[t._v("transformRequest")]),t._v(" "),s("td",[t._v("function/function[]")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("接受函数或者函数数组, 用于改变发出请求前改变请求值")])]),t._v(" "),s("tr",[s("td",[t._v("transformResponse")]),t._v(" "),s("td",[t._v("function/function[]")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td"),t._v(" "),s("td",[t._v("接受函数或者函数数组, 用于改变获得请求后改变返回值")])]),t._v(" "),s("tr",[s("td",[t._v("errTipTime")]),t._v(" "),s("td",[t._v("number")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v("2000")]),t._v(" "),s("td",[t._v("错误提示持续时间")])])])]),t._v(" "),s("p",[t._v("V1.x.x\n"),s("strong",[t._v("新版本遵循axios的配置规则, 下面是在此基础上新增的规则")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数名称")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("必须")]),t._v(" "),s("th",[t._v("默认")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("soucheMode")]),t._v(" "),s("td",[t._v("boolean")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v("true")]),t._v(" "),s("td",[t._v("默认以搜车约定的格式返回数据, false可以返回完整response")])]),t._v(" "),s("tr",[s("td",[t._v("windowSize")]),t._v(" "),s("td",[t._v("number")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v("6")]),t._v(" "),s("td",[t._v("一次性请求最大接口数, 目前未区分域名")])]),t._v(" "),s("tr",[s("td",[t._v("cache")]),t._v(" "),s("td",[t._v("缓存模式")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v("'no-store'")]),t._v(" "),s("td",[t._v("缓存模式,详情见下方表格")])]),t._v(" "),s("tr",[s("td",[t._v("cacheTime")]),t._v(" "),s("td",[t._v("缓存时间")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v("180000")]),t._v(" "),s("td",[t._v("缓存的时间")])])])]),t._v(" "),s("p",[s("strong",[t._v("cache参数说明")])]),t._v(" "),s("blockquote",[s("p",[t._v("目前缓存是以请求path为标识的, 因此暂时不适用于分页数据")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数名称")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("no-store")]),t._v(" "),s("td",[t._v("不走缓存,默认状态")])]),t._v(" "),s("tr",[s("td",[t._v("cache")]),t._v(" "),s("td",[t._v("有缓存先走缓存,没有再请求")])]),t._v(" "),s("tr",[s("td",[t._v("reload")]),t._v(" "),s("td",[t._v("有缓存先走缓存,然后再请求,返回数据,再次执行回调,如果没有缓存则走请求")])])])]),t._v(" "),s("h2",{attrs:{id:"其他说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他说明"}},[t._v("#")]),t._v(" 其他说明")]),t._v(" "),s("h3",{attrs:{id:"data-参数说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#data-参数说明"}},[t._v("#")]),t._v(" data 参数说明")]),t._v(" "),s("p",[t._v("最终发送给服务器的数据是 String 类型，如果传入的 data 不是 String 类型，会被转换成 String 。转换规则如下：")]),t._v(" "),s("p",[t._v("对于 GET 方法的数据，会将数据转换成 query string（encodeURIComponent(k)=encodeURIComponent(v)&encodeURIComponent(k)=encodeURIComponent(v)...）\n对于 POST 方法且 header['content-type'] 为 application/json 的数据，会对数据进行 JSON 序列化\n对于 POST 方法且 header['content-type'] 为 application/x-www-form-urlencoded 的数据，会将数据转换成 query string （encodeURIComponent(k)=encodeURIComponent(v)&encodeURIComponent(k)=encodeURIComponent(v)...）")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://taro-docs.jd.com/taro/docs/apis/network/request/request",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);